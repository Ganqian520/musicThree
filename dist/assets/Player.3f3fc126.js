var n=Object.defineProperty;var r=(s,t,e)=>t in s?n(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var i=(s,t,e)=>(r(s,typeof t!="symbol"?t+"":t,e),e);import{g as u,a as o}from"./request.f598e8a9.js";import{r as a}from"./vendor.1dfe2109.js";class d{constructor(){i(this,"ctx",null);i(this,"source",null);i(this,"audio",document.createElement("audio"));i(this,"fft",new Uint8Array(128));i(this,"analyser",null);i(this,"isPlay",a(!1));i(this,"music",a({}));i(this,"index",0);i(this,"listDou",a([]));i(this,"listNet",a([]));i(this,"listWant",[]);i(this,"indexNet",a(0));i(this,"indexDou",a(0));i(this,"updateNetCb",null);i(this,"updateProgressCb",null);i(this,"isUserSlide",!1);i(this,"order",0)}init(){this.ctx=new AudioContext,this.analyser=this.ctx.createAnalyser(),this.source=this.ctx.createMediaElementSource(this.audio),this.analyser.fftSize=256,this.source.connect(this.analyser).connect(this.ctx.destination),this.audio.ontimeupdate=()=>{this.updateNetCb&&this.music.value.platform=="net"&&this.updateNetCb(),this.updateProgressCb&&!this.isUserSlide&&this.updateProgressCb()};let t=this;this.audio.addEventListener("ended",this.next.bind(t))}async start(t,e){if(this.isPlay.value=!0,t.name==this.music.value.name){this.audio.play();return}this.ctx||this.init(),this.audio.pause(),this.music.value=t,this.index=e;let l;t.platform=="net"?(l=await u(t.id),this.indexNet.value=e):t.platform=="dou"&&(l=t.url,this.indexDou.value=e);let h=await o(l);this.audio.src=h,this.audio.play()}next(){if(this.listWant.length==0){let t=this.music.value.platform=="net"?this.listNet.value:this.listDou.value;this.order==0?(this.index=this.index<t.length-1?this.index+1:0,this.start(t[this.index],this.index)):this.order==1?(this.index=Math.floor(Math.random()*t.length-1),this.start(t[this.index],this.index)):this.order==2&&this.audio.play()}else this.start(this.listWant[0]),this.listWant.shift()}last(){let t=this.music.value.platform=="net"?this.listNet.value:this.listDou.value;this.index=this.index-1<0?0:this.index-1,this.start(t[this.index],this.index)}pause(){this.audio.pause(),this.isPlay.value=!1}resume(){console.log("resume"),this.audio.play(),this.isPlay.value=!0}}const p=new d;export{p};
